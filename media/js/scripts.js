var root = location.protocol + '//' + location.host;var nb_produits;//contien les id de produits que l'on a dans le paniervar panier_product = [];$(document).on('ready', function () {	//init datepicker	$('.datepicker').pickadate({		selectMonths: true, // Creates a dropdown to control month		selectYears: 15 // Creates a dropdown of 15 years to control year	});	    //initialisation panier recuperation des id produits    $('.produits-ul').find('.product_panier_detail').each(function (index, data) {        panier_product.push({            "id": $(data).data('id'),            "quantity": $(data).data('nb')        });    });    //valeur en px a partir de laquelle notre navbar rétrécit    var shrink = 30;    //Activation sidenav    $("#sidenav-button").sideNav();    //activation carousel    $('.carousel').carousel();    //effet hover trop stylé sur le menu    $(document).on('mouseover', '.navlink', function () {        var rect = this.getBoundingClientRect();        var hover = document.getElementById('hover');        if ($(window).scrollTop() > shrink)            hover.style.height = '2px';        else            hover.style.height = '5px';        hover.style.width = this.offsetWidth + 'px';        hover.style.left = rect.left + 'px';    });    $(document).on('mouseout', '.navlink', function () {        var hover = document.getElementById('hover');        hover.style.height = '0px';    });    //apparition du login    $(document).on('click', '#login', function () {        $('#loginform').toggleClass('show');        $('#contenupanier').removeClass('show');    });    //apparition du panier    $(document).on('click', '#panier', function () {        $('#loginform').removeClass('show');        $('#contenupanier').toggleClass('show');    });    //validation du panier    $(document).on('click', '.submitPanierButton', function () {        $('#panierForm').submit();    });    $('.upQuantity').each(function (index, data) {        $(this).data('oldval', $(this).val());    });    /** desactiver le scroll sur les numbers */    $('#panierForm').on('focus', 'input[type=number]', function (e) {        $(this).on('mousewheel.disableScroll', function (e) {            e.preventDefault()        })    })    $('#panierForm').on('blur', 'input[type=number]', function (e) {        $(this).off('mousewheel.disableScroll')    })    $(document).on('change', '.upQuantity', function (event) {        var newVal = $(this).val();        var oldVal = $(this).data('oldval');        if (newVal > oldVal) {            nbProduitsPlus();            //up            $(this).data('oldval', newVal);            //appel ajax pour les produits            $.ajax({                url: root + "/PDOProject/Ajax/product/sessionProduct.php",                type: "post",                data: {id: $(this).data('idproduit')},                dataType: 'json',                success: function (data) {                    //placer le produit  dans le panier                    var result = $.grep(panier_product, function (e) {                        return e.id == data.id;                    });                    if (result.length == 0) {                        //on cree une nouvelle ligne au niveau du recap panier                        $('#contenupanier').find('.produits-ul').append('<li id="productline' + data.id + '"><span data-nb="1" data-id="' + data.id + '" class="' + data.categorie.color + ' margin-l-r">' + data.nom + '(x <span class="product_panier_quantity">1</span>)</span><span class="product_panier_prix right margin-sm-l">' + data.prix + '€</span></li>');                        //ajout de l'id dans le tableau                        panier_product.push({                            "id": data.id,                            "quantity": 1                        });                    } else {                        //mise a jour de la quantite du produit                        var old_quantity = parseInt($('.produits-ul').find('span[data-id="' + data.id + '"]').find('.product_panier_quantity').html());                        $('.produits-ul').find('span[data-id="' + data.id + '"]').find('.product_panier_quantity').html(old_quantity + 1);                        //mise a jour du prix du produit                        $_prix_produit = parseFloat((data.prix).replace(',', '.'));                        $_old_prix_produit = parseFloat($('.produits-ul').find('#productline' + data.id).find('.product_panier_prix').html());                        $_new_prix_produit = (parseFloat($_prix_produit) + $_old_prix_produit).toFixed(2);                        $('.produits-ul').find('#productline' + data.id).find('.product_panier_prix').html($_new_prix_produit);                        //mise a jour coté recap                        $_old_recap_line = parseInt($('#recapPanier' + data.id).find('.recapPriceProduit').html());                        $_maj_recap_line = parseInt($_old_recap_line + 1);                        $('#recapPanier' + data.id).find('.recapPriceProduit').html($_maj_recap_line);                        //pric de la ligne                        $_old_recap_price_line = parseFloat($('#recapPanier' + data.id).find('.recapRealyPriceLine').html());                        $_maj_recap_price_line = (parseFloat($_old_recap_price_line) + $_prix_produit).toFixed(2);                        $('#recapPanier' + data.id).find('.recapRealyPriceLine').html($_maj_recap_price_line);                        //prix total du panier                        $_old_recap_total_line = parseFloat($('.recapTotalPrice').html());                        $_maj_recap_total_line = (parseFloat($_old_recap_total_line) + $_prix_produit).toFixed(2);                        $('.recapTotalPrice').html($_maj_recap_total_line);                    }                    //mise à jour du prix du panier                    $_prix = (data.prix).replace(',', '.');                    $_old_prix = parseFloat($('#panierprice').html());                    $_maj_prix = (parseFloat($_prix) + $_old_prix).toFixed(2);                    $('#panierprice').html($_maj_prix + '€');                },                error: function (err) {                    console.log(err);                }            });        } else {            nbProduitsMoins();            //down            $(this).data('oldval', newVal);            //enlever un produit de la session            $.ajax({                url: root + "/PDOProject/Ajax/product/sessionProductDown.php",                type: "post",                data: {id: $(this).data('idproduit')},                dataType: 'json',                success: function (data) {                    //modification cote front office                    if (data.nb > 0) {                        //encore des produits                        //modification cote panier                        var old_quantity = parseInt($('.produits-ul').find('span[data-id="' + data.id + '"]').find('.product_panier_quantity').html());                        $('.produits-ul').find('span[data-id="' + data.id + '"]').find('.product_panier_quantity').html(old_quantity - 1);                        //mise a jour du prix du produit                        $_prix_produit = parseFloat((data.prix).replace(',', '.'));                        $_old_prix_produit = parseFloat($('.produits-ul').find('#productline' + data.id).find('.product_panier_prix').html());                        $_new_prix_produit = (parseFloat($_old_prix_produit) - $_prix_produit).toFixed(2);                        $('.produits-ul').find('#productline' + data.id).find('.product_panier_prix').html($_new_prix_produit);                        //mise à jour du prix du panier                        $_old_prix = parseFloat($('#panierprice').html());                        $_maj_prix = (parseFloat($_old_prix) - $_prix_produit).toFixed(2);                        $('#panierprice').html($_maj_prix + '€');                        //modification cote recap                        $_old_recap_line = parseInt($('#recapPanier' + data.id).find('.recapPriceProduit').html());                        $_maj_recap_line = parseInt($_old_recap_line - 1);                        $('#recapPanier' + data.id).find('.recapPriceProduit').html($_maj_recap_line);                        //prix                        $_old_recap_price_line = parseFloat($('#recapPanier' + data.id).find('.recapRealyPriceLine').html());                        $_maj_recap_price_line = (parseFloat($_old_recap_price_line) - $_prix_produit).toFixed(2);                        $('#recapPanier' + data.id).find('.recapRealyPriceLine').html($_maj_recap_price_line);                        //prix total du panier                        $_old_recap_total_line = parseFloat($('.recapTotalPrice').html());                        $_maj_recap_total_line = (parseFloat($_old_recap_total_line) - $_prix_produit).toFixed(2);                        $('.recapTotalPrice').html($_maj_recap_total_line);                    } else {                        //suppression du cote du panier                        $('.produits-ul').find('#productline' + data.id).remove();                        //suppression cote page                        $('#panierrow' + data.id).remove();                        //prix du panier                        $_prix_produit = parseFloat((data.prix).replace(',', '.'));                        $_old_prix = parseFloat($('#panierprice').html());                        $_maj_prix = (parseFloat($_old_prix) - $_prix_produit).toFixed(2);                        $('#panierprice').html($_maj_prix + '€');                        //prix total du panier recap                        $_old_recap_total_line = parseFloat($('.recapTotalPrice').html());                        $_maj_recap_total_line = (parseFloat($_old_recap_total_line) - $_prix_produit).toFixed(2);                        $('.recapTotalPrice').html($_maj_recap_total_line);                        //modification cote recap                        $('#recapPanier' + data.id).remove();                    }                }            });        }    });    //boutton je veux -> ajout de produit dans la session de l'utilisateur en ajax    $(document).on('click', '#wantProduit', function () {        //recuperation de l'id        $.ajax({            url: root + "/PDOProject/Ajax/product/sessionProduct.php",            type: "post",            data: {id: $(this).data('idproduit')},            dataType: 'json',            success: function (data) {                //placer le produit  dans le panier                var result = $.grep(panier_product, function (e) {                    return e.id == data.id;                });                if (result.length == 0) {                    //on cree une nouvelle ligne au niveau du recap panier                    $('#contenupanier').find('.produits-ul').append('<li id="productline' + data.id + '"><span data-nb="1" data-id="' + data.id + '" class="' + data.categorie.color + ' margin-l-r">' + data.nom + '(x <span class="product_panier_quantity">1</span>)</span><span class="product_panier_prix right margin-sm-l">' + data.prix + '€</span></li>');                    //ajout de l'id dans le tableau                    panier_product.push({                        "id": data.id,                        "quantity": 1                    });                } else {                    //mise a jour de la quantite du produit                    var old_quantity = parseInt($('.produits-ul').find('span[data-id="' + data.id + '"]').find('.product_panier_quantity').html());                    $('.produits-ul').find('span[data-id="' + data.id + '"]').find('.product_panier_quantity').html(old_quantity + 1);                    //mise a jour du prix du produit                    $_prix_produit = parseFloat((data.prix).replace(',', '.'));                    $_old_prix_produit = parseFloat($('.produits-ul').find('#productline' + data.id).find('.product_panier_prix').html());                    $_new_prix_produit = (parseFloat($_prix_produit) + $_old_prix_produit).toFixed(2);                    $('.produits-ul').find('#productline' + data.id).find('.product_panier_prix').html($_new_prix_produit);                }                //mise à jour du prix du panier                $_prix = (data.prix).replace(',', '.');                $_old_prix = parseFloat($('#panierprice').html());                $_maj_prix = (parseFloat($_prix) + $_old_prix).toFixed(2);                $('#panierprice').html($_maj_prix + '€');            },            error: function (err) {                console.log(err);            }        });    });    //////////////////////////FILTRES ARTICLES/////////////////////////////    $(document).on('click', '.filtre', function () {        var temp = $('.chip.tags span');        if (typeof (temp) != 'undefined') {            for (var i = 0; i < temp.length; i++) {                if (temp[i].innerHTML == this.text) {                    return;                }            }        }        var newText = document.createTextNode(this.text);        var newTag = document.createElement('span');        newTag.appendChild(newText);        var couleur = this.getAttribute('class').replace('filtre ', '');        newTag.setAttribute('class', couleur);        var newChip = document.createElement('div');        newChip.setAttribute('class', 'chip tags');        newChip.appendChild(newTag);        var newIcon = document.createElement('i');        newIcon.setAttribute('class', 'material-icons closetag');        var newText = document.createTextNode('close');        newIcon.appendChild(newText);        newChip.appendChild(newIcon);        var filtres = document.getElementById('filtres');        filtres.appendChild(newChip);        filtrerTableau();    });    $(document).on('click', '.closetag', function () {        filtrerTableau();    });    function filtrerTableau() {        var filtres = document.getElementById('filtres');        var tab = document.getElementsByClassName('triable');        if (filtres.childNodes.length == 1) {            for (var i = 0; i < tab.length; i++) {                tab[i].parentNode.className = "";            }        }        for (var i = 0; i < tab.length; i++) {            for (var j = 1; j < filtres.childNodes.length; j++) {                if (tab[i].innerHTML != filtres.childNodes[j].childNodes[0].innerHTML) {                    tab[i].parentNode.className = "hidden";                }            }        }        for (var i = 0; i < tab.length; i++) {            for (var j = 1; j < filtres.childNodes.length; j++) {                if (tab[i].innerHTML == filtres.childNodes[j].childNodes[0].innerHTML) {                    tab[i].parentNode.className = "";                }            }        }    }    //////////////////////////AJOUT PANIER/////////////////////////////////    $(document).on('click', '.addpanier', function () {        // incrémenter les produits => en ajax plus tard         //choper la positon du produit sur lequel on clique        var elem = document.getElementById('particle' + this.getAttribute('data-id'));        var x = elem.getBoundingClientRect().left;        var y = elem.getBoundingClientRect().top + document.body.scrollTop;        //creer notre "particule"        var particle = document.createElement('div');        particle.className = 'particle';        //on la met au même niveau que notre boutton        particle.style.left = x + 'px';        particle.style.top = y + 'px';        //on créée l'image        var img = document.createElement('img');        img.setAttribute('src', elem.getAttribute('src'));        img.className = "img-responsive";        img.style.width = elem.offsetWidth + "px";        img.style.height = elem.offsetHeight + "px";        //on met l'image dans la div        particle.appendChild(img)        //on balance la div dans le body        document.body.appendChild(particle);        //on récup notre position de panier        var panier = document.getElementById('panier');        var px = panier.getBoundingClientRect().left + panier.offsetWidth - particle.offsetWidth / 5;        var py = panier.getBoundingClientRect().top + document.body.scrollTop + panier.offsetHeight - particle.offsetHeight / 5;        //grossissement/retrecssement de l'image        $(img).animate({            width: "+=100px",            height: "+=100px"        }, 100)                .animate({                    width: "-=100px",                    height: "-=100px",                    opacity: ".7"                }, 100)                .animate({                    width: $(img).width() / 10 + "px",                    height: $(img).height() / 10 + "px"                }, 100);        //et on anime notre div vers notre panier        $('.particle').animate({            top: "-=50px",            left: "-=50px"        }, 100).animate({            top: "+=50px",            left: "+=50px"        }, 100).animate({            top: [py, 'easeInSine'],            left: [px, 'easeOutSine']        }, {            duration: 400,            complete: function () {                document.body.removeChild(particle);                nbProduitsPlus();            }        });    });    //////////////////////////////////////CHOIX VERSION PRODUIT/////////////////////////////////    $(document).on('click', '#checkbox_version', function () {        $('.btnversion').toggleClass($(this).attr('data-textcolor'));        if ($('#checkbox_version').prop("checked")) {            $('#prix').html('Prix : 10€');        } else {            $('#prix').html('Prix : 25€');        }    });    //////////////////////////NAVBAR SCROLL SIZE/////////////////////////////    $(document).on('scroll', function () {        if ($(window).scrollTop() > shrink)            $('#navbar').addClass('shrink');        else            $('#navbar').removeClass('shrink');    });});function nbProduitsPlus() {    $('#nbproduits').html(parseInt($('#nbproduits').html()) + 1);}function nbProduitsMoins() {    $('#nbproduits').html(parseInt($('#nbproduits').html()) - 1);}